<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Red Light Green Light</title>

<style>
body{font-family:system-ui,sans-serif;background:#0f172a;color:#e5e7eb;display:flex;justify-content:center;padding:20px;}
.panel{background:#020617;padding:20px;border-radius:14px;width:380px;max-width:95vw;box-shadow:0 20px 40px rgba(0,0,0,.6);}
h1{text-align:center;margin-top:0}
.section{margin-bottom:16px}
label{font-size:.9rem;color:#cbd5f5}
.row{display:flex;gap:10px;flex-wrap:wrap}
.lights{display:flex;justify-content:space-around;margin:18px 0 10px;padding:5px;border-radius:12px;transition:.3s;}
.lights.ready{background:#1e40af;}
.light{width:80px;height:80px;border-radius:50%;background:#1f2937;opacity:.25;transition:.3s}
.light.red.active{background:#ef4444;opacity:1;box-shadow:0 0 25px rgba(239,68,68,.8)}
.light.green.active{background:#22c55e;opacity:1;box-shadow:0 0 25px rgba(34,197,94,.8)}
.light.amber.active{background:#f59e0b;opacity:1;box-shadow:0 0 25px rgba(245,158,11,.9)}
#message{text-align:center;min-height:48px;font-size:1.1rem;font-weight:600;margin-bottom:10px}
#countdown{text-align:center;font-size:1rem;color:#60a5fa;margin-bottom:8px;}
.stopwatch{text-align:center;font-size:.9rem;color:#9ca3af}

button{width:100%;padding:12px;border-radius:999px;border:none;background:#1d4ed8;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;margin-top:10px}
button.secondary{background:#374151}
button.secondary.active{background:#1e40af}

input[type="text"]{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#020617;
  color:#e5e7eb;
}

iframe{
  width:100%;
  aspect-ratio:16/9;
  border:none;
  border-radius:12px;
  margin-top:12px;
}
</style>
</head>

<body>
<div class="panel">
<h1>Red Light Green Light</h1>

<div class="section">
<label>YouTube video or playlist URL</label>
<input type="text" id="ytInput" placeholder="Paste YouTube link here">
</div>

<div id="playerContainer"></div>

<div id="countdown"></div>

<div class="lights" id="lightsContainer">
<div id="red" class="light red"></div>
<div id="amber" class="light amber"></div>
<div id="green" class="light green"></div>
</div>

<div id="message"></div>
<div class="stopwatch" id="stopwatch">00:00</div>

<button id="startBtn">Start</button>
<button id="readyBtn" class="secondary">Ready Mode</button>
<button id="resetBtn" class="secondary">Reset</button>
</div>

<script>
/* ========= YOUTUBE EMBED ========= */
const ytInput = document.getElementById('ytInput');
const playerContainer = document.getElementById('playerContainer');

function loadYouTube(url){
  let embed = '';
  try{
    const u = new URL(url);

    if(u.searchParams.get('list')){
      const list = u.searchParams.get('list');
      embed = `https://www.youtube.com/embed/videoseries?list=${list}&autoplay=1&mute=1`;
    }else{
      const id =
        u.searchParams.get('v') ||
        u.pathname.split('/').pop();
      embed = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1`;
    }

    playerContainer.innerHTML =
      `<iframe allow="autoplay; encrypted-media" allowfullscreen src="${embed}"></iframe>`;
  }catch(e){
    playerContainer.innerHTML = '';
  }
}

ytInput.addEventListener('change', e=>{
  if(e.target.value.trim()) loadYouTube(e.target.value.trim());
});

/* ========= AUDIO ========= */
let audioCtx;
function initAudio(){if(!audioCtx){audioCtx=new (window.AudioContext||window.webkitAudioContext)();}}
function tone(freq,d=0.25,g=0.25){
  initAudio();
  const o=audioCtx.createOscillator();
  const ga=audioCtx.createGain();
  o.connect(ga).connect(audioCtx.destination);
  o.frequency.value=freq;
  ga.gain.value=g;
  o.start();
  o.stop(audioCtx.currentTime+d);
}
function beep(type){
  if(type==='green') tone(750);
  if(type==='red') tone(300);
  if(type==='amber') tone(520,0.35);
  if(type==='cum'){tone(1200,0.2);setTimeout(()=>tone(1000,0.25),250);}
}

/* ========= GAME CORE (unchanged logic) ========= */
const authorityRed=['Hands off your cock','No touching','Hands off','Discipline required','No you dont'];
const greenTexts=['Fuck youself','Jerk jerk jerk','Jerk that cock','Up and down, up and down','Jerk it'];

let phase=null,timer=null;
let rtcActive=false,rtcTimers=[];
const redDur=5,greenDur=15;

function clearLights(){['red','green','amber'].forEach(id=>document.getElementById(id).classList.remove('active'));}

function readyMode(){
  initAudio();
  if(rtcActive) return;
  rtcActive=true;

  readyBtn.classList.add('active');
  lightsContainer.classList.add('ready');

  let verdictCountdown=60;
  countdown.textContent=`Verdict in: ${verdictCountdown}s`;

  function loop(){
    phase = phase==='red'?'green':'red';
    clearLights();
    document.getElementById(phase).classList.add('active');
    beep(phase);
    message.textContent =
      phase==='red'
        ? authorityRed[Math.floor(Math.random()*authorityRed.length)]
        : greenTexts[Math.floor(Math.random()*greenTexts.length)];

    rtcTimers.push(setTimeout(loop, phase==='red'?redDur*1000:greenDur*1000));
  }

  phase='red';
  document.getElementById('red').classList.add('active');
  message.textContent=authorityRed[Math.floor(Math.random()*authorityRed.length)];
  beep('red');
  rtcTimers.push(setTimeout(loop, redDur*1000));

  const cd=setInterval(()=>{
    verdictCountdown--;
    countdown.textContent=`Verdict in: ${verdictCountdown}s`;
    if(verdictCountdown<=0) clearInterval(cd);
  },1000);

  rtcTimers.push(setTimeout(()=>{
    rtcTimers.forEach(t=>clearTimeout(t));
    clearLights();
    lightsContainer.classList.remove('ready');
    readyBtn.classList.remove('active');
    countdown.textContent='';
    message.textContent='Verdict incoming...';

    setTimeout(()=>{
      if(Math.random()<0.5){
        message.textContent='Cum now';
        document.getElementById('green').classList.add('active');
        beep('cum');
      }else{
        message.textContent='Denied';
        beep('amber');
        rtcActive=false;
        readyMode();
      }
    },2500);
  },60000));
}

readyBtn.onclick=readyMode;
startBtn.onclick=initAudio;
resetBtn.onclick=()=>location.reload();
</script>
</body>
</html>
