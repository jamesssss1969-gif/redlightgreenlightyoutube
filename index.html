<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cumulative Red Green Light</title>
<style>
  body { font-family: system-ui, sans-serif; background:#0f172a; color:#e5e7eb; display:flex; justify-content:center; padding:20px; }
  .panel { background:#020617; padding:20px; border-radius:14px; width:380px; max-width:95vw; box-shadow:0 20px 40px rgba(0,0,0,.6); }
  h1 { text-align:center; margin-top:0; }
  .lights { display:flex; justify-content:space-around; margin:18px 0 10px; }
  .light { width:80px; height:80px; border-radius:50%; background:#1f2937; opacity:.25; transition:.3s; }
  .light.red.active { background:#ef4444; opacity:1; box-shadow:0 0 25px rgba(239,68,68,.8); }
  .light.green.active { background:#22c55e; opacity:1; box-shadow:0 0 25px rgba(34,197,94,.8); }
  #message { text-align:center; min-height:48px; font-size:1.1rem; font-weight:600; margin-bottom:10px; }
  .progress-bar { width:100%; height:12px; background:#1f2937; border-radius:6px; overflow:hidden; margin:10px 0; }
  .progress-fill { width:0%; height:100%; background:#22c55e; transition: width 0.3s; }
  button { width:100%; padding:12px; border-radius:999px; border:none; background:#1d4ed8; color:#fff; font-size:1rem; font-weight:600; cursor:pointer; margin-top:10px; }
  button:disabled { opacity:.5; cursor:not-allowed; }
  label { font-size:.85rem; color:#cbd5f5; display:block; margin-top:8px; }
</style>
</head>
<body>

<div class="panel">
  <h1>Cumulative Red Green Light</h1>

  <label>Difficulty</label>
  <select id="difficulty">
    <option value="easy">Easy (15-25 green points)</option>
    <option value="medium" selected>Medium (25-35 green points)</option>
    <option value="hard">Hard (35-45 green points)</option>
  </select>

  <div class="lights">
    <div id="red" class="light red"></div>
    <div id="green" class="light green"></div>
  </div>

  <div id="message"></div>

  <div class="progress-bar">
    <div id="progressFill" class="progress-fill"></div>
  </div>

  <button id="startBtn">Start</button>
  <button id="askBtn" disabled>Ask Permission</button>
</div>

<script>
const redLight = document.getElementById('red');
const greenLight = document.getElementById('green');
const message = document.getElementById('message');
const progressFill = document.getElementById('progressFill');
const startBtn = document.getElementById('startBtn');
const askBtn = document.getElementById('askBtn');
const difficultySelect = document.getElementById('difficulty');

let phase = null;
let timer = null;
let accumulation = 0;
let requiredAccum = 30; // default medium
let greenPoints = 1; // points per green light
let redDur = 5; // seconds
let greenDur = 5; // seconds

const redMessages = ['Stop now','Pause','Hold still','Wait'];
const greenMessages = ['Stimulate','Go','Keep going','Continue'];

function beep() {
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.connect(g).connect(ctx.destination);
  o.type = 'sine';
  o.frequency.value = 700;
  g.gain.setValueAtTime(.25, ctx.currentTime);
  o.start();
  o.stop(ctx.currentTime + 0.25);
}

function clearLights() {
  redLight.classList.remove('active');
  greenLight.classList.remove('active');
}

function randomChoice(arr) {
  return arr[Math.floor(Math.random()*arr.length)];
}

function updateProgress() {
  const percent = Math.min(100, (accumulation / requiredAccum) * 100);
  progressFill.style.width = percent + '%';
}

function startPhase(p) {
  phase = p;
  clearLights();
  if(p === 'red') {
    redLight.classList.add('active');
    message.textContent = randomChoice(redMessages);
    timer = setTimeout(()=>startPhase('green'), redDur*1000);
  } else if(p === 'green') {
    greenLight.classList.add('active');
    message.textContent = randomChoice(greenMessages);
    beep();
    accumulation += greenPoints;
    updateProgress();
    timer = setTimeout(()=>startPhase('red'), greenDur*1000);
  }
}

startBtn.onclick = () => {
  const diff = difficultySelect.value;
  if(diff==='easy'){ requiredAccum=20; }
  else if(diff==='medium'){ requiredAccum=30; }
  else if(diff==='hard'){ requiredAccum=40; }

  accumulation = 0;
  updateProgress();
  startPhase('green');
  askBtn.disabled = false;
};

askBtn.onclick = () => {
  if(accumulation >= requiredAccum){
    message.textContent = 'Permission granted! ðŸŽ‰';
    clearLights();
  } else {
    message.textContent = 'Denied! Keep going...';
    accumulation = Math.max(0, accumulation - 2); // small penalty
    updateProgress();
  }
};
</script>

</body>
</html>
